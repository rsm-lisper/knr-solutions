23 20 69 6e  63 6c 75 64  65 20 3c 73  74 64 69 6f  2e 68 3e 0a  23 20 69 6e  | #.include.<stdio.h>.#.in
63 6c 75 64  65 20 3c 73  74 64 6c 69  62 2e 68 3e  20 2f 2a 20  66 6f 72 20  | clude.<stdlib.h>./*.for.
61 74 6f 66  20 2a 2f 0a  23 20 69 6e  63 6c 75 64  65 20 3c 73  74 72 69 6e  | atof.*/.#.include.<strin
67 2e 68 3e  20 2f 2a 20  73 74 72 63  6d 70 20 2a  2f 0a 23 20  69 6e 63 6c  | g.h>./*.strcmp.*/.#.incl
75 64 65 20  3c 6d 61 74  68 2e 68 3e  0a 23 20 69  6e 63 6c 75  64 65 20 3c  | ude.<math.h>.#.include.<
63 74 79 70  65 2e 68 3e  0a 0a 69 6e  74 20 67 65  74 6f 70 20  28 63 68 61  | ctype.h>..int.getop.(cha
72 20 73 5b  5d 29 3b 0a  69 6e 74 20  67 65 74 63  68 20 28 76  6f 69 64 29  | r.s[]);.int.getch.(void)
3b 0a 76 6f  69 64 20 75  6e 67 65 74  63 68 20 28  69 6e 74 20  63 29 3b 0a  | ;.void.ungetch.(int.c);.
76 6f 69 64  20 70 75 73  68 20 28 64  6f 75 62 6c  65 20 66 29  3b 0a 64 6f  | void.push.(double.f);.do
75 62 6c 65  20 70 6f 70  20 28 76 6f  69 64 29 3b  0a 64 6f 75  62 6c 65 20  | uble.pop.(void);.double.
70 65 65 6b  20 28 76 6f  69 64 29 3b  0a 76 6f 69  64 20 63 6c  65 61 72 20  | peek.(void);.void.clear.
28 76 6f 69  64 29 3b 0a  76 6f 69 64  20 73 65 74  5f 76 61 72  20 28 63 68  | (void);.void.set_var.(ch
61 72 20 76  61 72 5f 6e  61 6d 65 2c  20 64 6f 75  62 6c 65 20  76 61 6c 75  | ar.var_name,.double.valu
65 29 3b 0a  64 6f 75 62  6c 65 20 67  65 74 5f 76  61 72 20 28  63 68 61 72  | e);.double.get_var.(char
20 76 61 72  5f 6e 61 6d  65 29 3b 0a  64 6f 75 62  6c 65 20 73  65 74 5f 6c  | .var_name);.double.set_l
61 73 74 20  28 64 6f 75  62 6c 65 20  76 61 6c 75  65 29 3b 0a  64 6f 75 62  | ast.(double.value);.doub
6c 65 20 67  65 74 5f 6c  61 73 74 20  28 76 6f 69  64 29 3b 0a  0a 23 20 64  | le.get_last.(void);..#.d
65 66 69 6e  65 20 47 45  54 4f 50 5f  4e 55 4d 42  45 52 20 27  30 27 20 20  | efine.GETOP_NUMBER.'0'..
20 2f 2a 20  73 69 67 6e  61 6c 20 74  68 61 74 20  61 20 6e 75  6d 62 65 72  | ./*.signal.that.a.number
20 77 61 73  20 66 6f 75  6e 64 20 2a  2f 0a 23 20  64 65 66 69  6e 65 20 47  | .was.found.*/.#.define.G
45 54 4f 50  5f 53 59 4d  42 4f 4c 20  27 61 27 20  20 20 2f 2a  20 73 69 67  | ETOP_SYMBOL.'a'.../*.sig
6e 61 6c 20  74 68 61 74  20 61 20 73  79 6d 62 6f  6c 20 77 61  73 20 66 6f  | nal.that.a.symbol.was.fo
75 6e 64 20  2a 2f 0a 23  20 64 65 66  69 6e 65 20  4d 41 58 4f  50 20 31 32  | und.*/.#.define.MAXOP.12
38 20 20 20  20 2f 2a 20  6d 61 78 20  73 69 7a 65  20 6f 66 20  6f 70 65 72  | 8..../*.max.size.of.oper
61 6e 64 20  6f 72 20 6f  70 65 72 61  74 6f 72 20  2a 2f 0a 23  20 64 65 66  | and.or.operator.*/.#.def
69 6e 65 20  42 55 46 53  49 5a 45 20  31 32 38 0a  23 20 64 65  66 69 6e 65  | ine.BUFSIZE.128.#.define
20 4d 41 58  56 41 4c 20  31 32 38 20  2f 2a 20 6d  61 78 20 64  65 70 74 68  | .MAXVAL.128./*.max.depth
20 6f 66 20  76 61 6c 20  73 74 61 63  6b 20 2a 2f  0a 0a 69 6e  74 20 73 70  | .of.val.stack.*/..int.sp
20 3d 20 30  3b 20 20 20  20 20 20 20  20 20 2f 2a  20 6e 65 78  74 20 66 72  | .=.0;........./*.next.fr
65 65 20 73  74 61 63 6b  20 70 6f 73  69 74 69 6f  6e 20 2a 2f  0a 64 6f 75  | ee.stack.position.*/.dou
62 6c 65 20  76 61 6c 5b  4d 41 58 56  41 4c 5d 3b  20 2f 2a 20  76 61 6c 75  | ble.val[MAXVAL];./*.valu
65 20 73 74  61 63 6b 20  2a 2f 0a 0a  69 6e 74 20  62 75 66 5b  42 55 46 53  | e.stack.*/..int.buf[BUFS
49 5a 45 5d  3b 20 20 20  20 2f 2a 20  62 75 66 66  65 72 20 66  6f 72 20 75  | IZE];..../*.buffer.for.u
6e 67 65 74  63 68 20 2a  2f 0a 69 6e  74 20 62 75  66 70 20 3d  20 30 3b 20  | ngetch.*/.int.bufp.=.0;.
20 20 20 20  20 20 20 2f  2a 20 6e 65  78 74 20 66  72 65 65 20  70 6f 73 69  | ......./*.next.free.posi
74 69 6f 6e  20 69 6e 20  62 75 66 20  2a 2f 0a 0a  64 6f 75 62  6c 65 20 76  | tion.in.buf.*/..double.v
61 72 73 5b  27 5a 27 2d  27 41 27 5d  3b 0a 64 6f  75 62 6c 65  20 6c 61 73  | ars['Z'-'A'];.double.las
74 5f 76 61  6c 3b 0a 0a  0a 2f 2a 20  72 65 76 65  72 73 65 20  50 6f 6c 69  | t_val;.../*.reverse.Poli
73 68 20 63  61 6c 63 75  6c 61 74 6f  72 20 2a 2f  0a 69 6e 74  20 6d 61 69  | sh.calculator.*/.int.mai
6e 20 28 29  0a 7b 0a 20  20 69 6e 74  20 74 79 70  65 3b 0a 20  20 64 6f 75  | n.().{...int.type;...dou
62 6c 65 20  6f 70 32 2c  20 6f 70 5f  72 3b 0a 20  20 63 68 61  72 20 73 5b  | ble.op2,.op_r;...char.s[
4d 41 58 4f  50 5d 3b 0a  0a 20 20 77  68 69 6c 65  20 28 28 74  79 70 65 20  | MAXOP];....while.((type.
3d 20 67 65  74 6f 70 28  73 29 29 20  21 3d 20 45  4f 46 29 20  7b 0a 20 20  | =.getop(s)).!=.EOF).{...
20 20 73 77  69 74 63 68  20 28 74 79  70 65 29 20  7b 0a 20 20  20 20 63 61  | ..switch.(type).{.....ca
73 65 20 47  45 54 4f 50  5f 53 59 4d  42 4f 4c 3a  0a 20 20 20  20 20 20 69  | se.GETOP_SYMBOL:.......i
66 20 28 73  74 72 63 6d  70 28 22 73  69 6e 22 2c  20 73 29 20  3d 3d 20 30  | f.(strcmp("sin",.s).==.0
29 20 7b 20  20 20 20 20  20 20 20 20  20 2f 2a 20  6d 61 74 68  20 73 69 6e  | ).{........../*.math.sin
20 2a 2f 0a  09 70 75 73  68 28 73 69  6e 28 70 6f  70 28 29 29  29 3b 0a 20  | .*/..push(sin(pop()));..
20 20 20 20  20 7d 20 65  6c 73 65 20  69 66 20 28  73 74 72 63  6d 70 28 22  | .....}.else.if.(strcmp("
63 6f 73 22  2c 20 73 29  20 3d 3d 20  30 29 20 7b  20 20 20 2f  2a 20 6d 61  | cos",.s).==.0).{.../*.ma
74 68 20 63  6f 73 20 2a  2f 0a 09 70  75 73 68 28  63 6f 73 28  70 6f 70 28  | th.cos.*/..push(cos(pop(
29 29 29 3b  0a 20 20 20  20 20 20 7d  20 65 6c 73  65 20 69 66  20 28 73 74  | )));.......}.else.if.(st
72 63 6d 70  28 22 74 61  6e 22 2c 20  73 29 20 3d  3d 20 30 29  20 7b 20 20  | rcmp("tan",.s).==.0).{..
20 2f 2a 20  6d 61 74 68  20 74 61 6e  20 2a 2f 0a  09 70 75 73  68 28 74 61  | ./*.math.tan.*/..push(ta
6e 28 70 6f  70 28 29 29  29 3b 0a 20  20 20 20 20  20 7d 20 65  6c 73 65 20  | n(pop()));.......}.else.
69 66 20 28  73 74 72 63  6d 70 28 22  61 73 69 6e  22 2c 20 73  29 20 3d 3d  | if.(strcmp("asin",.s).==
20 30 29 20  7b 20 20 2f  2a 20 6d 61  74 68 20 61  73 69 6e 20  2a 2f 0a 09  | .0).{../*.math.asin.*/..
70 75 73 68  28 61 73 69  6e 28 70 6f  70 28 29 29  29 3b 0a 20  20 20 20 20  | push(asin(pop()));......
20 7d 20 65  6c 73 65 20  69 66 20 28  73 74 72 63  6d 70 28 22  61 63 6f 73  | .}.else.if.(strcmp("acos
22 2c 20 73  29 20 3d 3d  20 30 29 20  7b 20 20 2f  2a 20 6d 61  74 68 20 61  | ",.s).==.0).{../*.math.a
63 6f 73 20  2a 2f 0a 09  70 75 73 68  28 61 63 6f  73 28 70 6f  70 28 29 29  | cos.*/..push(acos(pop())
29 3b 0a 20  20 20 20 20  20 7d 20 65  6c 73 65 20  69 66 20 28  73 74 72 63  | );.......}.else.if.(strc
6d 70 28 22  61 74 61 6e  22 2c 20 73  29 20 3d 3d  20 30 29 20  7b 20 20 2f  | mp("atan",.s).==.0).{../
2a 20 6d 61  74 68 20 61  74 61 6e 20  2a 2f 0a 09  70 75 73 68  28 61 74 61  | *.math.atan.*/..push(ata
6e 28 70 6f  70 28 29 29  29 3b 0a 20  20 20 20 20  20 7d 20 65  6c 73 65 20  | n(pop()));.......}.else.
69 66 20 28  73 74 72 63  6d 70 28 22  61 74 61 6e  32 22 2c 20  73 29 20 3d  | if.(strcmp("atan2",.s).=
3d 20 30 29  20 7b 20 2f  2a 20 6d 61  74 68 20 61  74 61 6e 32  20 2a 2f 0a  | =.0).{./*.math.atan2.*/.
09 70 75 73  68 28 61 74  61 6e 32 28  70 6f 70 28  29 2c 20 70  6f 70 28 29  | .push(atan2(pop(),.pop()
29 29 3b 0a  20 20 20 20  20 20 7d 20  65 6c 73 65  20 69 66 20  28 73 74 72  | ));.......}.else.if.(str
63 6d 70 28  22 73 69 6e  68 22 2c 20  73 29 20 3d  3d 20 30 29  20 7b 20 20  | cmp("sinh",.s).==.0).{..
2f 2a 20 6d  61 74 68 20  73 69 6e 68  20 2a 2f 0a  09 70 75 73  68 28 73 69  | /*.math.sinh.*/..push(si
6e 68 28 70  6f 70 28 29  29 29 3b 0a  20 20 20 20  20 20 7d 20  65 6c 73 65  | nh(pop()));.......}.else
20 69 66 20  28 73 74 72  63 6d 70 28  22 63 6f 73  68 22 2c 20  73 29 20 3d  | .if.(strcmp("cosh",.s).=
3d 20 30 29  20 7b 20 20  2f 2a 20 6d  61 74 68 20  63 6f 73 68  20 2a 2f 0a  | =.0).{../*.math.cosh.*/.
09 70 75 73  68 28 63 6f  73 68 28 70  6f 70 28 29  29 29 3b 0a  20 20 20 20  | .push(cosh(pop()));.....
20 20 7d 20  65 6c 73 65  20 69 66 20  28 73 74 72  63 6d 70 28  22 74 61 6e  | ..}.else.if.(strcmp("tan
68 22 2c 20  73 29 20 3d  3d 20 30 29  20 7b 20 20  2f 2a 20 6d  61 74 68 20  | h",.s).==.0).{../*.math.
74 61 6e 68  20 2a 2f 0a  09 70 75 73  68 28 74 61  6e 68 28 70  6f 70 28 29  | tanh.*/..push(tanh(pop()
29 29 3b 0a  20 20 20 20  20 20 7d 20  65 6c 73 65  20 69 66 20  28 73 74 72  | ));.......}.else.if.(str
63 6d 70 28  22 65 78 70  22 2c 20 73  29 20 3d 3d  20 30 29 20  7b 20 20 20  | cmp("exp",.s).==.0).{...
2f 2a 20 6d  61 74 68 20  65 78 70 20  2a 2f 0a 09  70 75 73 68  28 65 78 70  | /*.math.exp.*/..push(exp
28 70 6f 70  28 29 29 29  3b 0a 20 20  20 20 20 20  7d 20 65 6c  73 65 20 69  | (pop()));.......}.else.i
66 20 28 73  74 72 63 6d  70 28 22 6c  6f 67 22 2c  20 73 29 20  3d 3d 20 30  | f.(strcmp("log",.s).==.0
29 20 7b 20  20 20 2f 2a  20 6d 61 74  68 20 6c 6f  67 20 2a 2f  0a 09 70 75  | ).{.../*.math.log.*/..pu
73 68 28 6c  6f 67 28 70  6f 70 28 29  29 29 3b 0a  20 20 20 20  20 20 7d 20  | sh(log(pop()));.......}.
65 6c 73 65  20 69 66 20  28 73 74 72  63 6d 70 28  22 6c 6f 67  31 30 22 2c  | else.if.(strcmp("log10",
20 73 29 20  3d 3d 20 30  29 20 7b 20  2f 2a 20 6d  61 74 68 20  6c 6f 67 31  | .s).==.0).{./*.math.log1
30 20 2a 2f  0a 09 70 75  73 68 28 6c  6f 67 31 30  28 70 6f 70  28 29 29 29  | 0.*/..push(log10(pop()))
3b 0a 20 20  20 20 20 20  7d 20 65 6c  73 65 20 69  66 20 28 73  74 72 63 6d  | ;.......}.else.if.(strcm
70 28 22 70  6f 77 22 2c  20 73 29 20  3d 3d 20 30  29 20 7b 20  20 20 2f 2a  | p("pow",.s).==.0).{.../*
20 6d 61 74  68 20 70 6f  77 20 2a 2f  0a 09 6f 70  32 20 3d 20  70 6f 70 28  | .math.pow.*/..op2.=.pop(
29 3b 0a 09  70 75 73 68  28 70 6f 77  28 70 6f 70  28 29 2c 20  6f 70 32 29  | );..push(pow(pop(),.op2)
29 3b 0a 20  20 20 20 20  20 7d 20 65  6c 73 65 20  69 66 20 28  73 74 72 63  | );.......}.else.if.(strc
6d 70 28 22  73 71 72 74  22 2c 20 73  29 20 3d 3d  20 30 29 20  7b 20 20 2f  | mp("sqrt",.s).==.0).{../
2a 20 6d 61  74 68 20 73  71 72 74 20  2a 2f 0a 09  70 75 73 68  28 73 71 72  | *.math.sqrt.*/..push(sqr
74 28 70 6f  70 28 29 29  29 3b 0a 20  20 20 20 20  20 7d 20 65  6c 73 65 20  | t(pop()));.......}.else.
69 66 20 28  73 74 72 63  6d 70 28 22  63 65 69 6c  22 2c 20 73  29 20 3d 3d  | if.(strcmp("ceil",.s).==
20 30 29 20  7b 20 20 2f  2a 20 6d 61  74 68 20 63  65 69 6c 20  2a 2f 0a 09  | .0).{../*.math.ceil.*/..
70 75 73 68  28 63 65 69  6c 28 70 6f  70 28 29 29  29 3b 0a 20  20 20 20 20  | push(ceil(pop()));......
20 7d 20 65  6c 73 65 20  69 66 20 28  73 74 72 63  6d 70 28 22  66 6c 6f 6f  | .}.else.if.(strcmp("floo
72 22 2c 20  73 29 20 3d  3d 20 30 29  20 7b 20 2f  2a 20 6d 61  74 68 20 66  | r",.s).==.0).{./*.math.f
6c 6f 6f 72  20 2a 2f 0a  09 70 75 73  68 28 66 6c  6f 6f 72 28  70 6f 70 28  | loor.*/..push(floor(pop(
29 29 29 3b  0a 20 20 20  20 20 20 7d  20 65 6c 73  65 20 69 66  20 28 73 74  | )));.......}.else.if.(st
72 63 6d 70  28 22 61 62  73 22 2c 20  73 29 20 3d  3d 20 30 29  20 7b 20 20  | rcmp("abs",.s).==.0).{..
20 2f 2a 20  6d 61 74 68  20 66 61 62  73 20 2a 2f  0a 09 70 75  73 68 28 66  | ./*.math.fabs.*/..push(f
61 62 73 28  70 6f 70 28  29 29 29 3b  0a 20 20 20  20 20 20 7d  20 65 6c 73  | abs(pop()));.......}.els
65 20 69 66  20 28 73 74  72 63 6d 70  28 22 63 6c  65 61 72 22  2c 20 73 29  | e.if.(strcmp("clear",.s)
20 3d 3d 20  30 29 20 7b  20 2f 2a 20  63 6c 65 61  72 20 74 68  65 20 73 74  | .==.0).{./*.clear.the.st
61 63 6b 20  2a 2f 0a 09  63 6c 65 61  72 28 29 3b  0a 20 20 20  20 20 20 7d  | ack.*/..clear();.......}
20 65 6c 73  65 20 69 66  20 28 73 74  72 63 6d 70  28 22 70 65  65 6b 22 2c  | .else.if.(strcmp("peek",
20 73 29 20  3d 3d 20 30  29 20 7b 20  20 20 2f 2a  20 70 65 65  6b 20 74 6f  | .s).==.0).{.../*.peek.to
70 20 73 74  61 63 6b 20  65 6c 65 6d  65 6e 74 20  2a 2f 0a 09  70 72 69 6e  | p.stack.element.*/..prin
74 66 28 22  5c 74 25 2e  38 67 5c 6e  22 2c 20 70  65 65 6b 28  29 29 3b 0a  | tf("\t%.8g\n",.peek());.
20 20 20 20  20 20 7d 20  65 6c 73 65  20 69 66 20  28 73 74 72  63 6d 70 28  | ......}.else.if.(strcmp(
22 73 77 61  70 22 2c 20  73 29 20 3d  3d 20 30 29  20 7b 20 2f  2a 20 73 77  | "swap",.s).==.0).{./*.sw
61 70 20 74  6f 70 20 74  77 6f 20 73  74 61 63 6b  20 65 6c 65  6d 65 6e 74  | ap.top.two.stack.element
73 20 2a 2f  0a 09 6f 70  5f 72 20 3d  20 70 6f 70  28 29 3b 0a  09 6f 70 32  | s.*/..op_r.=.pop();..op2
20 3d 20 70  6f 70 28 29  3b 0a 09 70  75 73 68 28  6f 70 5f 72  29 3b 0a 09  | .=.pop();..push(op_r);..
70 75 73 68  28 6f 70 32  29 3b 0a 20  20 20 20 20  20 7d 20 65  6c 73 65 20  | push(op2);.......}.else.
69 66 20 28  73 74 72 6c  65 6e 28 73  29 3d 3d 32  20 26 26 0a  09 09 20 28  | if.(strlen(s)==2.&&....(
28 73 5b 30  5d 3d 3d 27  3a 27 20 26  26 20 28 28  73 5b 31 5d  3e 3d 27 41  | (s[0]==':'.&&.((s[1]>='A
27 20 26 26  20 73 5b 31  5d 3c 3d 27  5a 27 29 20  7c 7c 20 28  73 5b 31 5d  | '.&&.s[1]<='Z').||.(s[1]
3d 3d 27 3f  27 29 29 29  20 7c 7c 0a  09 09 20 20  28 73 5b 31  5d 3d 3d 27  | =='?'))).||.....(s[1]=='
3d 27 20 26  26 20 73 5b  30 5d 3e 3d  27 41 27 20  26 26 20 73  5b 30 5d 3c  | ='.&&.s[0]>='A'.&&.s[0]<
3d 27 5a 27  29 29 29 20  7b 20 2f 2a  20 76 61 72  69 61 62 6c  65 73 20 2a  | ='Z'))).{./*.variables.*
2f 0a 09 69  66 20 28 73  5b 31 5d 3d  3d 27 3d 27  29 20 7b 20  2f 2a 20 76  | /..if.(s[1]=='=').{./*.v
61 72 69 61  62 6c 65 20  73 65 74 20  2a 2f 0a 09  20 20 73 65  74 5f 76 61  | ariable.set.*/....set_va
72 28 73 5b  30 5d 2c 20  70 6f 70 28  29 29 3b 0a  09 7d 20 65  6c 73 65 20  | r(s[0],.pop());..}.else.
69 66 20 28  73 5b 31 5d  3d 3d 27 3f  27 29 20 7b  20 2f 2a 20  6c 61 73 74  | if.(s[1]=='?').{./*.last
20 72 65 74  75 72 6e 20  2a 2f 0a 09  20 20 70 75  73 68 28 67  65 74 5f 6c  | .return.*/....push(get_l
61 73 74 28  29 29 3b 0a  09 7d 20 65  6c 73 65 20  7b 20 2f 2a  20 76 61 72  | ast());..}.else.{./*.var
69 61 62 6c  65 20 67 65  74 20 2a 2f  0a 09 20 20  70 75 73 68  28 67 65 74  | iable.get.*/....push(get
5f 76 61 72  28 73 5b 31  5d 29 29 3b  0a 09 7d 0a  20 20 20 20  20 20 7d 20  | _var(s[1]));..}.......}.
65 6c 73 65  20 7b 0a 09  70 72 69 6e  74 66 28 22  65 72 72 6f  72 3a 20 75  | else.{..printf("error:.u
6e 6b 6e 6f  77 6e 20 73  79 6d 62 6f  6c 20 25 73  5c 6e 22 2c  20 73 29 3b  | nknown.symbol.%s\n",.s);
0a 20 20 20  20 20 20 7d  0a 20 20 20  20 20 20 62  72 65 61 6b  3b 0a 20 20  | .......}.......break;...
20 20 63 61  73 65 20 47  45 54 4f 50  5f 4e 55 4d  42 45 52 3a  0a 20 20 20  | ..case.GETOP_NUMBER:....
20 20 20 70  75 73 68 28  61 74 6f 66  28 73 29 29  3b 0a 20 20  20 20 20 20  | ...push(atof(s));.......
62 72 65 61  6b 3b 0a 20  20 20 20 63  61 73 65 20  27 2b 27 3a  0a 20 20 20  | break;.....case.'+':....
20 20 20 70  75 73 68 28  70 6f 70 28  29 20 2b 20  70 6f 70 28  29 29 3b 0a  | ...push(pop().+.pop());.
20 20 20 20  20 20 62 72  65 61 6b 3b  0a 20 20 20  20 63 61 73  65 20 27 2a  | ......break;.....case.'*
27 3a 0a 20  20 20 20 20  20 70 75 73  68 28 70 6f  70 28 29 20  2a 20 70 6f  | ':.......push(pop().*.po
70 28 29 29  3b 0a 20 20  20 20 20 20  62 72 65 61  6b 3b 0a 20  20 20 20 63  | p());.......break;.....c
61 73 65 20  27 2d 27 3a  0a 20 20 20  20 20 20 6f  70 32 20 3d  20 70 6f 70  | ase.'-':.......op2.=.pop
28 29 3b 0a  20 20 20 20  20 20 70 75  73 68 28 70  6f 70 28 29  20 2d 20 6f  | ();.......push(pop().-.o
70 32 29 3b  0a 20 20 20  20 20 20 62  72 65 61 6b  3b 0a 20 20  20 20 63 61  | p2);.......break;.....ca
73 65 20 27  2f 27 3a 0a  20 20 20 20  20 20 6f 70  32 20 3d 20  70 6f 70 28  | se.'/':.......op2.=.pop(
29 3b 0a 20  20 20 20 20  20 69 66 20  28 6f 70 32  20 21 3d 20  30 2e 30 29  | );.......if.(op2.!=.0.0)
20 7b 0a 09  70 75 73 68  28 70 6f 70  28 29 20 2f  20 6f 70 32  29 3b 0a 20  | .{..push(pop()./.op2);..
20 20 20 20  20 7d 20 65  6c 73 65 20  7b 0a 09 70  72 69 6e 74  66 28 22 65  | .....}.else.{..printf("e
72 72 6f 72  3a 20 7a 65  72 6f 20 64  69 76 69 73  6f 72 5c 6e  22 29 3b 0a  | rror:.zero.divisor\n");.
20 20 20 20  20 20 7d 0a  20 20 20 20  20 20 62 72  65 61 6b 3b  0a 20 20 20  | ......}.......break;....
20 63 61 73  65 20 27 25  27 3a 0a 20  20 20 20 20  20 6f 70 32  20 3d 20 70  | .case.'%':.......op2.=.p
6f 70 28 29  3b 0a 20 20  20 20 20 20  69 66 20 28  6f 70 32 20  21 3d 20 30  | op();.......if.(op2.!=.0
2e 30 29 20  7b 0a 09 70  75 73 68 28  28 6c 6f 6e  67 20 69 6e  74 29 20 70  | .0).{..push((long.int).p
6f 70 28 29  20 25 20 28  6c 6f 6e 67  20 69 6e 74  29 20 6f 70  32 29 3b 0a  | op().%.(long.int).op2);.
20 20 20 20  20 20 7d 20  65 6c 73 65  20 7b 0a 09  70 72 69 6e  74 66 28 22  | ......}.else.{..printf("
65 72 72 6f  72 3a 20 7a  65 72 6f 20  6d 6f 64 75  6c 75 73 5c  6e 22 29 3b  | error:.zero.modulus\n");
0a 20 20 20  20 20 20 7d  0a 20 20 20  20 20 20 62  72 65 61 6b  3b 0a 20 20  | .......}.......break;...
20 20 63 61  73 65 20 27  5c 6e 27 3a  0a 20 20 20  20 20 20 70  72 69 6e 74  | ..case.'\n':.......print
66 28 22 5c  74 25 2e 38  67 5c 6e 22  2c 20 73 65  74 5f 6c 61  73 74 28 70  | f("\t%.8g\n",.set_last(p
6f 70 28 29  29 29 3b 0a  20 20 20 20  20 20 62 72  65 61 6b 3b  0a 20 20 20  | op()));.......break;....
20 64 65 66  61 75 6c 74  3a 0a 20 20  20 20 20 20  70 72 69 6e  74 66 28 22  | .default:.......printf("
65 72 72 6f  72 3a 20 75  6e 6b 6e 6f  77 6e 20 63  6f 6d 6d 61  6e 64 20 25  | error:.unknown.command.%
73 5c 6e 22  2c 20 73 29  3b 0a 20 20  20 20 20 20  62 72 65 61  6b 3b 0a 20  | s\n",.s);.......break;..
20 20 20 7d  0a 20 20 7d  0a 20 20 72  65 74 75 72  6e 20 30 3b  0a 7d 0a 0a  | ...}...}...return.0;.}..
0a 2f 2a 20  67 65 74 6f  70 3a 20 67  65 74 20 6e  65 78 74 20  63 68 61 72  | ./*.getop:.get.next.char
61 63 74 65  72 2c 20 6e  75 6d 65 72  69 63 20 6f  70 65 72 61  6e 64 20 6f  | acter,.numeric.operand.o
72 20 66 75  6e 63 74 69  6f 6e 2f 63  6f 6d 6d 61  6e 64 20 2a  2f 0a 69 6e  | r.function/command.*/.in
74 20 67 65  74 6f 70 20  28 63 68 61  72 20 73 5b  5d 29 0a 7b  0a 20 20 69  | t.getop.(char.s[]).{...i
6e 74 20 69  2c 20 63 3b  0a 20 20 0a  20 20 77 68  69 6c 65 20  28 28 73 5b  | nt.i,.c;......while.((s[
30 5d 20 3d  20 63 20 3d  20 67 65 74  63 68 28 29  29 20 3d 3d  20 27 20 27  | 0].=.c.=.getch()).==.'.'
20 7c 7c 20  63 20 3d 3d  20 27 5c 74  27 29 20 7b  0a 20 20 7d  0a 0a 20 20  | .||.c.==.'\t').{...}....
69 66 20 28  63 20 3d 3d  20 45 4f 46  20 7c 7c 20  63 20 3d 3d  20 27 5c 6e  | if.(c.==.EOF.||.c.==.'\n
27 29 20 7b  0a 20 20 20  20 72 65 74  75 72 6e 20  63 3b 0a 20  20 7d 0a 20  | ').{.....return.c;...}..
20 2f 2a 20  6f 70 65 72  61 74 6f 72  2c 20 73 69  6e 67 6c 65  20 64 69 67  | ./*.operator,.single.dig
69 74 20 6e  75 6d 62 65  72 20 6f 72  20 73 69 6e  67 6c 65 20  6c 65 74 74  | it.number.or.single.lett
65 72 20 73  79 6d 62 6f  6c 20 2a 2f  0a 20 20 69  66 20 28 28  73 5b 31 5d  | er.symbol.*/...if.((s[1]
20 3d 20 63  20 3d 20 67  65 74 63 68  28 29 29 20  3d 3d 20 27  20 27 20 7c  | .=.c.=.getch()).==.'.'.|
7c 20 63 20  3d 3d 20 27  5c 74 27 20  7c 7c 20 63  20 3d 3d 20  27 5c 6e 27  | |.c.==.'\t'.||.c.==.'\n'
20 7c 7c 20  63 20 3d 3d  20 45 4f 46  29 20 7b 0a  20 20 20 20  75 6e 67 65  | .||.c.==.EOF).{.....unge
74 63 68 28  63 29 3b 0a  20 20 20 20  73 5b 31 5d  20 3d 20 27  5c 30 27 3b  | tch(c);.....s[1].=.'\0';
0a 20 20 20  20 63 20 3d  20 73 5b 30  5d 3b 0a 20  20 20 20 2f  2a 20 6e 75  | .....c.=.s[0];...../*.nu
6d 62 65 72  20 2a 2f 0a  20 20 20 20  69 66 20 28  69 73 64 69  67 69 74 28  | mber.*/.....if.(isdigit(
63 29 29 20  7b 0a 20 20  20 20 20 20  72 65 74 75  72 6e 20 47  45 54 4f 50  | c)).{.......return.GETOP
5f 4e 55 4d  42 45 52 3b  0a 20 20 20  20 7d 0a 20  20 20 20 2f  2a 20 73 69  | _NUMBER;.....}...../*.si
6e 67 6c 65  20 6c 65 74  74 65 72 20  73 79 6d 62  6f 6c 20 5b  61 2d 7a 41  | ngle.letter.symbol.[a-zA
2d 5a 5d 20  2a 2f 0a 20  20 20 20 65  6c 73 65 20  69 66 20 28  28 63 20 3e  | -Z].*/.....else.if.((c.>
3d 20 27 41  27 20 26 26  20 63 20 3c  3d 20 27 5a  27 29 20 7c  7c 20 28 63  | =.'A'.&&.c.<=.'Z').||.(c
20 3e 3d 20  27 61 27 20  26 26 20 63  20 3c 3d 20  27 7a 27 29  29 20 7b 0a  | .>=.'a'.&&.c.<=.'z')).{.
20 20 20 20  20 20 72 65  74 75 72 6e  20 47 45 54  4f 50 5f 53  59 4d 42 4f  | ......return.GETOP_SYMBO
4c 3b 0a 20  20 20 20 7d  0a 20 20 20  20 2f 2a 20  6f 70 65 72  61 74 6f 72  | L;.....}...../*.operator
20 2a 2f 0a  20 20 20 20  65 6c 73 65  20 7b 0a 20  20 20 20 20  20 72 65 74  | .*/.....else.{.......ret
75 72 6e 20  63 3b 0a 20  20 20 20 7d  0a 20 20 7d  0a 20 20 2f  2a 20 6e 75  | urn.c;.....}...}.../*.nu
6d 62 65 72  20 6f 72 20  73 79 6d 62  6f 6c 20 2a  2f 0a 20 20  65 6c 73 65  | mber.or.symbol.*/...else
20 7b 0a 20  20 20 20 75  6e 67 65 74  63 68 28 63  29 3b 0a 20  20 20 20 63  | .{.....ungetch(c);.....c
20 3d 20 73  5b 30 5d 3b  0a 20 20 20  20 2f 2a 20  6e 75 6d 62  65 72 20 2a  | .=.s[0];...../*.number.*
2f 0a 20 20  20 20 69 66  20 28 69 73  64 69 67 69  74 28 63 29  20 7c 7c 20  | /.....if.(isdigit(c).||.
63 20 3d 3d  20 27 2d 27  20 7c 7c 20  63 20 3d 3d  20 27 2e 27  29 20 7b 0a  | c.==.'-'.||.c.==.'.').{.
20 20 20 20  20 20 69 20  3d 20 30 3b  0a 20 20 20  20 20 20 69  66 20 28 63  | ......i.=.0;.......if.(c
20 3d 3d 20  27 2d 27 29  20 7b 20 2f  2a 20 6d 6f  76 65 20 62  79 20 61 20  | .==.'-').{./*.move.by.a.
6d 69 6e 75  73 20 28 2d  29 20 73 69  67 6e 20 2a  2f 0a 09 73  5b 2b 2b 69  | minus.(-).sign.*/..s[++i
5d 20 3d 20  63 20 3d 20  67 65 74 63  68 28 29 3b  0a 20 20 20  20 20 20 7d  | ].=.c.=.getch();.......}
0a 20 20 20  20 20 20 69  66 20 28 69  73 64 69 67  69 74 28 63  29 29 20 7b  | .......if.(isdigit(c)).{
20 2f 2a 20  63 6f 6c 6c  65 63 74 20  69 6e 74 65  67 65 72 20  70 61 72 74  | ./*.collect.integer.part
20 2a 2f 0a  09 77 68 69  6c 65 20 28  69 73 64 69  67 69 74 28  73 5b 2b 2b  | .*/..while.(isdigit(s[++
69 5d 20 3d  20 63 20 3d  20 67 65 74  63 68 28 29  29 29 20 7b  0a 09 7d 0a  | i].=.c.=.getch())).{..}.
20 20 20 20  20 20 7d 0a  20 20 20 20  20 20 69 66  20 28 63 20  3d 3d 20 27  | ......}.......if.(c.==.'
2e 27 29 20  7b 20 2f 2a  20 63 6f 6c  6c 65 63 74  20 66 72 61  63 74 69 6f  | .').{./*.collect.fractio
6e 20 70 61  72 74 20 2a  2f 0a 09 77  68 69 6c 65  20 28 69 73  64 69 67 69  | n.part.*/..while.(isdigi
74 28 73 5b  2b 2b 69 5d  20 3d 20 63  20 3d 20 67  65 74 63 68  28 29 29 29  | t(s[++i].=.c.=.getch()))
20 7b 0a 09  7d 0a 20 20  20 20 20 20  7d 0a 20 20  20 20 20 20  73 5b 69 5d  | .{..}.......}.......s[i]
20 3d 20 27  5c 30 27 3b  0a 20 20 20  20 20 20 75  6e 67 65 74  63 68 28 63  | .=.'\0';.......ungetch(c
29 3b 0a 20  20 20 20 20  20 72 65 74  75 72 6e 20  47 45 54 4f  50 5f 4e 55  | );.......return.GETOP_NU
4d 42 45 52  3b 0a 20 20  20 20 7d 0a  20 20 20 20  2f 2a 20 73  79 6d 62 6f  | MBER;.....}...../*.symbo
6c 20 2a 2f  0a 20 20 20  20 65 6c 73  65 20 7b 0a  20 20 20 20  20 20 69 20  | l.*/.....else.{.......i.
3d 20 30 3b  0a 20 20 20  20 20 20 77  68 69 6c 65  20 28 28 73  5b 2b 2b 69  | =.0;.......while.((s[++i
5d 20 3d 20  63 20 3d 20  67 65 74 63  68 28 29 29  20 21 3d 20  27 20 27 20  | ].=.c.=.getch()).!=.'.'.
26 26 20 63  20 21 3d 20  27 5c 74 27  20 26 26 20  63 20 21 3d  20 27 5c 6e  | &&.c.!=.'\t'.&&.c.!=.'\n
27 20 26 26  20 63 20 21  3d 20 45 4f  46 29 20 7b  0a 20 20 20  20 20 20 7d  | '.&&.c.!=.EOF).{.......}
0a 20 20 20  20 20 20 73  5b 69 5d 20  3d 20 27 5c  30 27 3b 0a  20 20 20 20  | .......s[i].=.'\0';.....
20 20 75 6e  67 65 74 63  68 28 63 29  3b 0a 20 20  20 20 20 20  72 65 74 75  | ..ungetch(c);.......retu
72 6e 20 47  45 54 4f 50  5f 53 59 4d  42 4f 4c 3b  0a 20 20 20  20 7d 0a 20  | rn.GETOP_SYMBOL;.....}..
20 7d 0a 7d  0a 0a 0a 2f  2a 20 67 65  74 63 68 3a  20 67 65 74  20 61 20 28  | .}.}.../*.getch:.get.a.(
70 6f 73 73  69 62 6c 79  20 70 75 73  68 65 64 2d  62 61 63 6b  29 20 63 68  | possibly.pushed-back).ch
61 72 61 63  74 65 72 20  2a 2f 0a 69  6e 74 20 67  65 74 63 68  20 28 76 6f  | aracter.*/.int.getch.(vo
69 64 29 0a  7b 0a 20 20  72 65 74 75  72 6e 20 28  62 75 66 70  20 3e 20 30  | id).{...return.(bufp.>.0
29 20 3f 20  62 75 66 5b  2d 2d 62 75  66 70 5d 20  3a 20 67 65  74 63 68 61  | ).?.buf[--bufp].:.getcha
72 28 29 3b  0a 7d 0a 0a  0a 2f 2a 20  75 6e 67 65  74 63 68 3a  20 70 75 73  | r();.}.../*.ungetch:.pus
68 20 63 68  61 72 61 63  74 65 72 20  62 61 63 6b  20 6f 6e 20  69 6e 70 75  | h.character.back.on.inpu
74 20 2a 2f  0a 76 6f 69  64 20 75 6e  67 65 74 63  68 20 28 69  6e 74 20 63  | t.*/.void.ungetch.(int.c
29 0a 7b 0a  20 20 69 66  20 28 62 75  66 70 20 3e  3d 20 42 55  46 53 49 5a  | ).{...if.(bufp.>=.BUFSIZ
45 29 20 7b  0a 20 20 20  20 70 72 69  6e 74 66 28  22 75 6e 67  65 74 63 68  | E).{.....printf("ungetch
3a 20 74 6f  6f 20 6d 61  6e 79 20 63  68 61 72 61  63 74 65 72  73 5c 6e 22  | :.too.many.characters\n"
29 3b 0a 20  20 7d 20 65  6c 73 65 20  7b 0a 20 20  20 20 62 75  66 5b 62 75  | );...}.else.{.....buf[bu
66 70 2b 2b  5d 20 3d 20  63 3b 0a 20  20 7d 0a 7d  0a 0a 0a 2f  2a 20 70 75  | fp++].=.c;...}.}.../*.pu
73 68 3a 20  70 75 73 68  20 66 20 6f  6e 74 6f 20  73 74 61 63  6b 20 2a 2f  | sh:.push.f.onto.stack.*/
0a 76 6f 69  64 20 70 75  73 68 20 28  64 6f 75 62  6c 65 20 66  29 0a 7b 0a  | .void.push.(double.f).{.
20 20 69 66  20 28 73 70  20 3c 20 4d  41 58 56 41  4c 29 20 7b  0a 20 20 20  | ..if.(sp.<.MAXVAL).{....
20 76 61 6c  5b 73 70 2b  2b 5d 20 3d  20 66 3b 0a  20 20 7d 20  65 6c 73 65  | .val[sp++].=.f;...}.else
20 7b 0a 20  20 20 20 70  72 69 6e 74  66 28 22 65  72 72 6f 72  3a 20 73 74  | .{.....printf("error:.st
61 63 6b 20  66 75 6c 6c  2c 20 63 61  6e 27 74 20  70 75 73 68  20 25 67 5c  | ack.full,.can't.push.%g\
6e 22 2c 20  66 29 3b 0a  20 20 7d 0a  7d 0a 0a 0a  2f 2a 20 70  6f 70 3a 20  | n",.f);...}.}.../*.pop:.
70 6f 70 20  61 6e 64 20  72 65 74 75  72 6e 20 74  6f 70 20 76  61 6c 75 65  | pop.and.return.top.value
20 66 72 6f  6d 20 73 74  61 63 6b 20  2a 2f 0a 64  6f 75 62 6c  65 20 70 6f  | .from.stack.*/.double.po
70 20 28 76  6f 69 64 29  0a 7b 0a 20  20 69 66 20  28 73 70 20  3e 20 30 29  | p.(void).{...if.(sp.>.0)
20 7b 0a 20  20 20 20 72  65 74 75 72  6e 20 76 61  6c 5b 2d 2d  73 70 5d 3b  | .{.....return.val[--sp];
0a 20 20 7d  20 65 6c 73  65 20 7b 0a  20 20 20 20  70 72 69 6e  74 66 28 22  | ...}.else.{.....printf("
65 72 72 6f  72 3a 20 73  74 61 63 6b  20 65 6d 70  74 79 5c 6e  22 29 3b 0a  | error:.stack.empty\n");.
20 20 20 20  72 65 74 75  72 6e 20 30  2e 30 3b 0a  20 20 7d 0a  7d 0a 0a 0a  | ....return.0.0;...}.}...
2f 2a 20 70  65 65 6b 3a  20 72 65 74  75 72 6e 20  74 6f 70 20  76 61 6c 75  | /*.peek:.return.top.valu
65 20 66 72  6f 6d 20 73  74 61 63 6b  20 77 69 74  68 6f 75 74  20 70 6f 70  | e.from.stack.without.pop
70 69 6e 67  20 2a 2f 0a  64 6f 75 62  6c 65 20 70  65 65 6b 20  28 76 6f 69  | ping.*/.double.peek.(voi
64 29 0a 7b  0a 20 20 69  66 20 28 73  70 20 3e 20  30 29 20 7b  0a 20 20 20  | d).{...if.(sp.>.0).{....
20 72 65 74  75 72 6e 20  76 61 6c 5b  73 70 20 2d  20 31 5d 3b  0a 20 20 7d  | .return.val[sp.-.1];...}
20 65 6c 73  65 20 7b 0a  20 20 20 20  70 72 69 6e  74 66 28 22  65 72 72 6f  | .else.{.....printf("erro
72 3a 20 73  74 61 63 6b  20 65 6d 70  74 79 5c 6e  22 29 3b 0a  20 20 20 20  | r:.stack.empty\n");.....
72 65 74 75  72 6e 20 30  2e 30 3b 0a  20 20 7d 0a  7d 0a 0a 0a  2f 2a 20 63  | return.0.0;...}.}.../*.c
6c 65 61 72  3a 20 63 6c  65 61 72 20  74 68 65 20  73 74 61 63  6b 20 2a 2f  | lear:.clear.the.stack.*/
0a 76 6f 69  64 20 63 6c  65 61 72 20  28 76 6f 69  64 29 0a 7b  0a 20 20 73  | .void.clear.(void).{...s
70 20 3d 20  30 3b 0a 7d  0a 0a 0a 2f  2a 20 73 65  74 5f 76 61  72 3a 20 73  | p.=.0;.}.../*.set_var:.s
65 74 20 76  61 72 69 61  62 6c 65 20  2a 2f 0a 76  6f 69 64 20  73 65 74 5f  | et.variable.*/.void.set_
76 61 72 20  28 63 68 61  72 20 76 61  72 5f 6e 61  6d 65 2c 20  64 6f 75 62  | var.(char.var_name,.doub
6c 65 20 76  61 6c 75 65  29 0a 7b 0a  20 20 76 61  72 73 5b 76  61 72 5f 6e  | le.value).{...vars[var_n
61 6d 65 2d  27 41 27 5d  20 3d 20 76  61 6c 75 65  3b 0a 7d 0a  0a 0a 2f 2a  | ame-'A'].=.value;.}.../*
20 67 65 74  5f 76 61 72  3a 20 67 65  74 20 76 61  72 69 61 62  6c 65 20 76  | .get_var:.get.variable.v
61 6c 75 65  20 2a 2f 0a  64 6f 75 62  6c 65 20 67  65 74 5f 76  61 72 20 28  | alue.*/.double.get_var.(
63 68 61 72  20 76 61 72  5f 6e 61 6d  65 29 0a 7b  0a 20 20 72  65 74 75 72  | char.var_name).{...retur
6e 20 76 61  72 73 5b 76  61 72 5f 6e  61 6d 65 2d  27 41 27 5d  3b 0a 7d 0a  | n.vars[var_name-'A'];.}.
0a 0a 2f 2a  20 73 65 74  5f 6c 61 73  74 3a 20 73  65 74 20 6c  61 73 74 20  | ../*.set_last:.set.last.
72 65 74 75  72 6e 65 64  20 76 61 6c  75 65 20 2a  2f 0a 64 6f  75 62 6c 65  | returned.value.*/.double
20 73 65 74  5f 6c 61 73  74 20 28 64  6f 75 62 6c  65 20 76 61  6c 75 65 29  | .set_last.(double.value)
0a 7b 0a 20  20 72 65 74  75 72 6e 20  6c 61 73 74  5f 76 61 6c  20 3d 20 76  | .{...return.last_val.=.v
61 6c 75 65  3b 0a 7d 0a  0a 0a 2f 2a  20 67 65 74  5f 6c 61 73  74 3a 20 67  | alue;.}.../*.get_last:.g
65 74 20 6c  61 73 74 20  72 65 74 75  72 6e 65 64  20 76 61 6c  75 65 20 2a  | et.last.returned.value.*
2f 0a 64 6f  75 62 6c 65  20 67 65 74  5f 6c 61 73  74 20 28 76  6f 69 64 29  | /.double.get_last.(void)
0a 7b 0a 20  20 72 65 74  75 72 6e 20  6c 61 73 74  5f 76 61 6c  3b 0a 7d 0a  | .{...return.last_val;.}.
